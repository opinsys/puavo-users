<% page_title t('titles.schools'), @school.displayName, t('titles.devices'), t('titles.device_statistics') %>

<% content_for :javascript do %>
<%= javascript_include_tag 'sortableTable' %>
<%= javascript_include_tag 'inpageTabs' %>
<% end %>

<h1><%= t('.title') %></h1>

<% if @total_devices == 0 %>
<p class="genericNotice"><%= t('.no_devices') %></p>
<% else %>

<% if @with_info.count == 0 %>
<p class="genericNotice"><%= t('.no_devices_with_hardware_info') %></p>
<% else %>

<div class="tabBar" id="devStatsTabs">
  <ul>
    <li>
        <a href="#withInfoTab"><%= t('device_statistics.device_lists.with_info') %> (<%= @with_info.count %>)</a>
    </li>

    <li>
        <a href="#withoutInfoTab"><%= t('device_statistics.device_lists.without_info') %> (<%= @without_info.count %>)</a>
    </li>

    <li>
        <a href="#imageStatisticsTab"><%= t('device_statistics.images.title') %> (<%= @image_stats.count %>)</a>
    </li>
  </ul>
</div>

<div class="tabContentsWrapper">

<div class="tabContentsVisible" id="withInfoTab">

<h2><%= t('device_statistics.device_lists.with_info') %></h2>

<p><%= t('.count_header',
         :total => @total_devices,
         :with_info => @with_info.count) %></p>

<table class="list" id="withInfo">
  <tr class="thead">
    <th><%= sortable_list_column_header(t('activeldap.attributes.device.puavoHostname')) %></th>
    <th><%= sortable_list_column_header(t('device_statistics.columns.timestamp')) %></th>
    <th><%= sortable_list_column_header(t('activeldap.attributes.device.puavoDeviceType')) %></th>
    <th><%= sortable_list_column_header(t('activeldap.attributes.device.puavoDeviceImage')) %></th>
    <th><%= sortable_list_column_header(t('device_statistics.columns.cpu')) %></th>
    <th><%= sortable_list_column_header(t('device_statistics.columns.memory')) %></th>
    <th><%= sortable_list_column_header(t('device_statistics.columns.hard_drive')) %></th>
  </tr>

<% @with_info.each do |device| %>
  <tr>
    <td data-title="<%= t('activeldap.attributes.device.puavoHostname') %>">
      <%= link_to insert_wbr(device[:name]), device_path(@school, device[:device]) %>
    </td>

    <td data-title="<%= t('device_statistics.columns.timestamp') %>">
      <%= (Time.at(device[:timestamp]).localtime.strftime('%Y-%m-%d&nbsp;%H:%M:%S')).html_safe %>
    </td>

    <td data-title="<%= t('activeldap.attributes.device.puavoDeviceType') %>">
      <%= device[:type] %>
    </td>

    <td data-title="<%= t('activeldap.attributes.device.puavoDeviceImage') %>">
      <%= insert_wbr(device[:image]) %>
    </td>

    <td data-title="<%= t('device_statistics.columns.cpu') %>">
      <%= device[:cpu_count] %> Ã— <%= insert_wbr(device[:cpu_name]) %>
    </td>

    <td data-title="<%= t('device_statistics.columns.memory') %>">
      <%= device[:memory] %>
    </td>

    <td data-title="<%= t('device_statistics.columns.hard_drive') %>">
      <%= device[:hard_drive] %>
    </td>

  </tr>
<% end %>
</table>

</div>

<div class="tabContentsInvisible" id="withoutInfoTab">

<% unless @without_info.empty? %>
<h2 id="withoutInfoHeader"><%= t('device_statistics.device_lists.without_info') %></h2>
<div id="withoutInfoInner">

<p><%= t('device_statistics.device_lists.without_info_count', :count => @without_info.count) %></p>

<ul class="withoutInfo">
<% @without_info.each do |device| %>
  <li><%= link_to device[:device].puavoHostname, device_path(device[:school], device[:device]) %></li>
<% end %>
</ul>
</div>
<% end %>

</div>

<div class="tabContentsInvisible" id="imageStatisticsTab">

<%= render :partial => 'images', :locals => { :image_stats => @image_stats } %>

</div>

</div>

<% end %>
<% end %>

<script>
$(document).ready(function() {
    new SortableTable(
        "withInfo",
        [
            [ COLUMN_TYPE_STRING, COLUMN_FLAG_HTML ],   // hostname
            [ COLUMN_TYPE_STRING, 0 ],                  // timestamp (last update)
            [ COLUMN_TYPE_STRING, 0 ],                  // device type
            [ COLUMN_TYPE_STRING, 0 ],                  // desktop image name
            [ COLUMN_TYPE_STRING, 0 ],                  // CPU
            [ COLUMN_TYPE_INTEGER, 0 ],                 // RAM
            [ COLUMN_TYPE_INTEGER, 0 ],                 // hard drive size
        ],
        "fi",
        1, SORT_ORDER_DESCENDING
    );

    new Tabs("devStatsTabs", 0);
});
</script>
