<p><%= t('device_statistics.images.header', :total => @total_devices, :count => @image_stats.count) %></p>

<table class="imageStats">
  <% @image_stats.each_with_index do |image| %>
  <tr class="header">
    <td class="nameCol">
      <strong><%= image[:name] %></strong> (<%= image[:uses] %> <%= image[:uses] == 1 ? t('device_statistics.images.device') : t('device_statistics.images.devices') %>, <%= image[:percentage] %>%)
    </td>

    <td class="barCol">
      <div class="barOuter">
        <div class="barInner" style="width: <%= image[:percentage] %>%;">&nbsp;</div>
      </div>
    </td>
  </tr>

  <tr class="deviceListRow" style="display: none;">
    <td colspan="2">
      <ul>
        <% image[:devices].each do |device| %>
        <li>
          <a href="/devices/<%= device[:school].id %>/devices/<%= device[:id] %>"><%= device[:name] %></a>
          <% if show_school_links %>
          (<%= link_to device[:school].displayName, school_path(device[:school]) %>)
          <% end %>
        </li>
        <% end %>
      </ul>
    </td>
  </tr>
  <% end %>
</table>

<script>
// Make the image headers toggleable
$(document).ready(function() {
  $(".deviceListRow").hide();

  $(".imageStats .header").click(function(event) {
    $(this).next(".deviceListRow").toggle();
  });
});
</script>
